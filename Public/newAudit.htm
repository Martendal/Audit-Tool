

<h1>New Audit</h1>

<div ng-app="auditTool" ng-controller="newAuditCtrl">
	<div id="surveyElement"></div>
	<div id="surveyResult"></div>
    <canvas id="chartResult" width="400" height="400"></canvas>
</div>

<script type="text/javascript">
	var id = '1';

	$.get('/getPackage/' + id, function(json) {
        console.log('json: ', json);
	    Survey.Survey.cssType = "bootstrap";
        Survey.defaultBootstrapCss.navigationButton = "btn btn-green";

		window.survey = new Survey.Model(json);


        survey.onComplete.add(function(result) {
            //document.querySelector('#surveyResult').innerHTML = "result: " + JSON.stringify(result.data);
            var ctx = document.getElementById("chartResult");
            //console.log(result.data);
            var means = [];
            var labels = [];
            
            for (l=0; l<json.pages.length; l++) {
                labels.push(json.pages[l].questions[0].title);
                var meantmp = 0;
                var name = json.pages[l].questions[0].name;
                var val = 0;
                //console.log(result.data[name]["1"]);
                var len = json.pages[l].questions[0].rows.length;
                for(r=0; r<json.pages[l].questions[0].rows.length; r++) {
                    console.log('tata');
                    val = parseInt(result.data[name][json.pages[l].questions[0].rows[r].value]);
                    console.log("typeof val : ",typeof(val));
                    if(val < 6){
                        meantmp += val;
                    }
                    else if(val == 6) {
                        //TODO: Calculate max and min means with extreme values of val for the "I don't know" option and create 2 other graphs on the radar graph
                    }
                    else {
                        len --;
                    }
                }
                console.log("meantmp = ", meantmp);
                meantmp = meantmp/len;
                means.push(meantmp);
            }
            console.log("means = ", means);

            var myChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Security of the company',
                        data: means,
                        
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero:true
                            }
                        }]
                    }
                }
            });










        });

        $("#surveyElement").Survey({ 
            model: survey 
        });
	});

</script>


